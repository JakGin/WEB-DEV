{% extends "auctions/layout.html" %}

{% block body %}

    <div id="add_to_watchlist_container">
        <div>
            <h2>{{ listing.title }}</h2>
        </div>
        {% if user.is_authenticated %}
        <div>
            {% if add_to_watchlist %}
                <a href="{% url 'add_to_watchlist' listing.id %}"><div class="add_watchlist_button">Add to watchlist</div></a>
            {% else %}
                <a href="{% url 'remove_from_watchlist_listing' listing.id %}"><div class="remove_watchlist_button">Remove from watchlist</div></a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <div class="form-group border">

        <div class="listing_imgbox"><img class="center-fit" src="{{ listing.image_url }}" alt="{{ listing.title }}"></div>
      
        <div class="bid">
            <strong>${{ current_bid_price|stringformat:".2f" }}</strong>
        </div>

        {% if user.is_authenticated %}
            <form action="{% url 'listing' listing.id %}" method="POST">
                {% csrf_token %}
                <div class="form-group" style="margin-left: 10px; margin-right: 10px;">
                    <div style="float: left;  width: 200px">
                        <input class="form-control" type="number" step="0.01" min="0" name="bid" placeholder="Bid" required>
                    </div>
                    <div style="float: left; margin: 5px;">
                        <input type="submit" value="Bid" style="float: left;">
                    </div>
                    <div style="clear: both;"></div>
                </div>
            </form>
        {% endif %}
        {% if error_message %}
            <div style="color: red;">{{ error_message }}</div>
        {% endif %}
      
        <div class="des">
            <h4>Description</h4>
            {{ listing.description }}
        </div>
        <div class="details">

        <h4>Details</h4>
            <li>Listed by <strong>{{ listing.user.username }}</strong></li>
            <li>Date of creation: <strong>{{ listing.datetime }}</strong></li>
            <li>Category: <strong>{{ listing.category }}</strong> </li>
            <li>Starting bid: <strong>${{ listing.starting_bid|stringformat:".2f"  }}</strong></li>
            <li>Current bid by <strong>{{ potential_winner }}</strong> </li>
        </div>
    </div>

    <div class="des">
        <h4>Comments</h4>
        {% if user.is_authenticated %}
            <form action="{% url 'add_comment' listing.id %}" method="POST" style="margin-bottom: 10px;">
                {% csrf_token %}
                <textarea name="comment" rows="3" cols="50" maxlength="2048"></textarea>
                <input type="submit" value="Add">
            </form>
        {% endif %}
        <div class="comments">
            {% for comment in comments %}
                <div class="commentBox"> {{ comment.content }} </div>
                <div style="margin-left: 20px;"><strong>{{ comment.user }}</strong> <span style="margin-right: 10px;"></span> {{ comment.datetime }}</div>
            {% endfor %}
        </div>

    </div>

    {% if listing.user == request.user %}
        <form action="{% url 'close_listing' listing.id %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="Close this Listing" class="remove_watchlist_button" style="width: 200px; display: flex; justify-content: center;">
        </form>
    {% endif %}

{% endblock %}